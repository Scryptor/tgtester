# SendMsgTestForTG

Инструмент для тестирования и отладки отправки сообщений в Telegram через Bot API. Позволяет диагностировать проблемы с таймаутами, сетевыми соединениями и прокси.

## Возможности

- Веб-интерфейс для управления настройками и мониторинга
- Детальное логирование всех этапов HTTP-запроса (DNS, TCP, TLS, ответ)
- Логи в реальном времени через Server-Sent Events (SSE)
- Фильтрация логов по уровню (INFO/WARN/ERROR)
- Поиск по логам с подсветкой
- Экспорт логов в файл
- Статистика запросов (успешные/ошибки)
- Поддержка прокси (HTTP, SOCKS5)

## Сборка и запуск

```bash
# Сборка
go build -o SendMsgTestForTG ./cmd/server

# Запуск
./SendMsgTestForTG

# Запуск на другом порту
./SendMsgTestForTG -addr=:3000

# Запуск в режиме разработки
go run ./cmd/server
```

По умолчанию сервер запускается на порту `8080`. Откройте в браузере: http://localhost:8080

## Настройки

| Параметр | Обязательный | Описание |
|----------|--------------|----------|
| Chat ID | Да | ID чата/канала для отправки сообщений |
| Bot Token | Да | Токен Telegram бота |
| Thread ID | Нет | ID треда (топика) в супергруппе |
| Прокси URL | Нет | URL прокси в формате `http://user:pass@host:port` или `socks5://host:port` |
| Таймаут | Нет | Таймаут HTTP-запроса в секундах (по умолчанию: 60) |
| Интервал | Нет | Интервал между запросами в секундах (по умолчанию: 3) |

## Веб-интерфейс

### Панель управления
- **Настройки** — сворачиваемая панель с параметрами подключения
- **Запустить/Остановить** — управление отправкой сообщений
- **Статистика** — счётчики запросов, успешных и ошибок

### Управление логами
- **Пауза** — приостановить получение новых логов
- **Автопрокрутка** — автоматическая прокрутка к новым записям
- **Перенос строк** — включить/выключить перенос длинных строк
- **Фильтры INFO/WARN/ERROR** — показать/скрыть логи по уровню
- **Поиск** — фильтрация логов по тексту
- **Экспорт** — скачать логи в текстовый файл
- **Очистить** — очистить логи и сбросить статистику

### Цветовая кодировка логов
- Зелёный — INFO (информационные сообщения)
- Жёлтый — WARN (предупреждения)
- Красный — ERROR (ошибки)
- Голубой — сетевые операции (DNS, TCP, TLS)
- Фиолетовый — номер запроса
- Синий — результат запроса

## Логирование

Инструмент логирует все этапы HTTP-запроса:

1. **DNS lookup** — резолвинг домена, время, полученные IP-адреса
2. **TCP соединение** — установка соединения, время
3. **TLS handshake** — версия TLS, cipher suite, время
4. **Отправка запроса** — время отправки
5. **Получение ответа** — время до первого байта, статус, заголовки
6. **Чтение тела** — размер, время чтения
7. **Детали ошибок** — тип ошибки, причина таймаута

## API Endpoints

### GET `/api/config`
Получить текущую конфигурацию.

### POST `/api/config/update`
Обновить конфигурацию.

```json
{
  "chatID": "-1001234567890",
  "botToken": "123456789:ABC...",
  "messageThreadID": "12345",
  "proxyURL": "http://proxy:8080",
  "timeout": 60000000000,
  "interval": 3000000000
}
```

> Таймаут и интервал передаются в наносекундах (Go time.Duration)

### POST `/api/start`
Запустить отправку сообщений.

### POST `/api/stop`
Остановить отправку сообщений.

### GET `/api/status`
Получить статус отправки.

```json
{
  "running": true
}
```

### GET `/api/logs`
SSE-поток для получения логов в реальном времени.

## Структура проекта

```
SendMsgTestForTG/
├── cmd/server/main.go        — точка входа
├── internal/
│   ├── config/               — конфигурация и валидация
│   ├── telegram/             — HTTP клиент с трейсингом
│   ├── sender/               — логика отправки сообщений
│   └── server/               — HTTP handlers и SSE
└── web/static/index.html     — веб-интерфейс
```

## Логика интервалов

- Следующий запрос начинается через `интервал` после **начала** предыдущего запроса
- Если запрос занял меньше интервала — ожидание оставшегося времени
- Если запрос занял больше интервала — следующий запрос сразу (с предупреждением в логе)

## Технологии

- **Backend**: Go 1.21+
- **Frontend**: Alpine.js, Tailwind CSS
- **Логи**: Server-Sent Events (SSE)
